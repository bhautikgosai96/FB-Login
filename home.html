<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.6/ngStorage.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="lib/css/home.css">
    <title>Albumn</title>
</head>
<body ng-app="fbApp">

<div ng-controller="fbCtrl" ng-init="init()">
    <div class="row">
        <div class="profile">
            <p>Welcome {{profileName}}</p>
        </div>
    </div>
    <br/>
   <!-- <div ng-repeat="x in albumnList" ng-if="x.photo_count > 0">
        <h4 >{{x.name }}</h4>
        <h4 > Total images : {{x.photo_count}}</h4>
        <img ng-src ="{{ x.picture.url }}" width="50%" height="100%" class="img-responsive" style="min-height:252px; max-height:252px;"/>
    </div>-->
    <div class="w3-container">
        <div class="row" style="padding-left:10%; padding-right: 10%;">
            <div class="col-md-3" ng-repeat="x in albumnList" ng-if="x.photo_count > 0">
                <div class=" w3-card-4" style="height: 470px;">
                    <img ng-src ="{{ x.picture.url }}" style="width:100%; height:200px;">
                    <div class="w3-container">
                        <h4>Albumn Name: {{x.name }}</h4>
                        <h4 > Total images : {{x.photo_count}}</h4>
                        <button class="w3-round button1" ng-click="slideShow(x.photos)">Show Full Screen</button><br><br>
                        <button class="w3-round button1" ng-click="zip(x.photos)">Download</button><br/><br/>
                        <button class="w3-round button1" ng-click="googleDrive(x)">Move to Google Drive</button><br/>
                        <input type="checkbox"
                               ng-click="selectAlbumn(x)"/>Select for multiple albumn download
                    </div>
                </div>
                <br/><br/>

            </div>
         </div>
        <a style="margin-left: 10%;" ng-show="downSingleloadLink" href="{{downSingleloadLink}}" download>Single AlbumnDownload link:{{downSingleloadLink}}</a><br/><br/>
        <button  class="button2" ng-click="downloadAll()">Download All Album</button> <a ng-show="downloadAllLink" href="{{downloadAllLink}}" download>All Albumn Download Link:{{downloadAllLink}}</a><br/><br/>
        <button class="button2" ng-click="downloadSelectedAll()">Download Selected Album</button><a ng-show="downloadLink" href="{{downloadLink}}" download>Selected Albumn Download Link:{{downloadLink}}</a><br/><br/>
        <!--<button class="bigbtn" ng-click="googleDrive()">upload to google drive</button>-->
        <button class="button2" ng-click="googleDriveAllAlbumn()">Move All Albumn to google drive</button><br/><br/>
        <button class="button2" ng-click="googleDriveSelectedAlbumn()">Move Selected Albumn to google drive</button>
    </div>
</div>

<script>
    var app = angular.module('fbApp',['ngStorage']);



    app.controller('fbCtrl',function($scope,$http,$localStorage,$window,$rootScope){

        //fetching user photo and profilename
        $scope.init= function(){
            $rootScope.profileName = null;
            $scope.albumnList = [];
            $http.get('home.php')
                    .then(function(response){

                        $scope.data = response.data;
                        $rootScope.profileName = $scope.data[0];
                        var i;

                        for(i=1;i<$scope.data.length;i++){
                            $scope.albumnList.push($scope.data[i]);
                        }
                    });

        };

        //slideshow of albumn
        $scope.slideShow = function(photo){
            $localStorage.gallery = photo;
            $window.open('slideShow.html');
        };



        //code for selecting albumn
        $scope.selectedAlbumnList = [];
       $scope.selectAlbumn = function(item){

           var albumnData = {
               albumnName:'',
               image:[]
           };

           var albumn = item;
           albumnData.albumnName = albumn.name;
           var j;
           var albumnPhoto = albumn.photos;

           for (j = 0; j < albumnPhoto.length; j++) {

               albumnData.image.push(albumnPhoto[j].images[1].source);
           }



           var i;
           var index=0;
           var flag = false;
           if($scope.selectedAlbumnList.length==0){
               $scope.selectedAlbumnList.push(albumnData);

           }else{
               for(i=0;i<$scope.selectedAlbumnList.length;i++){

                   if(albumnData.albumnName===$scope.selectedAlbumnList[i].albumnName){
                       flag = true;
                        index = i;
                       break;
                   }else{
                       flag = false;
                   }
               }

               if(flag){
                   $scope.selectedAlbumnList.splice(index,1);

               }else{
                   $scope.selectedAlbumnList.push(albumnData);

               }
           }

       };

        //download selected albumn
        $scope.downloadSelectedAll = function() {

            if ($scope.selectedAlbumnList.length > 0){
                $http({
                    method: "POST",
                    url: 'downloadAllAlbum.php',
                    data: $scope.selectedAlbumnList,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(function mySuccess(data) {

                    var base_url = window.location.origin;
                    var str = data.data.slice(1,-1);
                    alert('Find download link at bottom of page.');
                    $scope.downloadLink = base_url + '/' + str;


                }, function myError(response) {
                    console.log(response);
                });
        }else{
                alert('Please, select albumn!!!');
            }
        };

        //download all albumn at one time
        $scope.downloadAll = function(){

            var lst = $scope.albumnList;
            var len = lst.length;

            if(len<=0){
                alert("There is no album.");
                return;
            };

            var allAlbumnList = [];
            var i;
            for(i=0;i<len;i++){
                var albumnData = {
                    albumnName:'',
                    image:[]
                };
                var albumn = lst[i];
                albumnData.albumnName = albumn.name;
                var j;
                var albumnPhoto = albumn.photos;

                    for (j = 0; j < albumnPhoto.length; j++) {
                        albumnData.image.push(albumnPhoto[j].images[1].source);
                    }
                    allAlbumnList.push(albumnData);
            }



            $http({
                method : "POST",
                url: 'downloadAllAlbum.php',
                data: allAlbumnList,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }).then(function mySuccess(data) {

                var base_url = window.location.origin;
                var str = data.data.slice(1,-1);
                alert('Find download link at bottom of page.');
                $scope.downloadAllLink= base_url+'/'+str;
            }, function myError(response) {
                console.log(response);
            });
        };

        //downloading single albumn
        $scope.zip = function(files){
            var image = [];
            for(i=0;i<files.length;i++)
            {
                image.push( files[i].images[1].source);
            }

            $http({
                method : "POST",
                url: 'zip.php',
                data: image,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }).then(function mySuccess(data) {

                var str = data.data.substr(1,18);
                var base_url = window.location.origin;
                alert('Find download link at bottom of page.');
                $scope.downSingleloadLink= base_url+'/'+str;
            }, function myError(response) {
                console.log(response);
            });
        };

        //Moving to picasa
        $scope.movePicasa =function(x){

            $scope.picasa= false;
             var albumData ={
                albumnName:'',
                img:[]

            };

            albumData.albumnName =x.name;
            var photos = x.photos;
            for(j=0;j<photos.length;j++){
                albumData.img.push(photos[j].images[1].source);
            }
            $http({
                method: 'POST',
                url: 'sendAlbumn.php',
                data: albumData,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }).then(function mySuccess(data) {
                $scope.picasa = true;
                var base_url = window.location.origin;
                $window.open(base_url+'/uploadPicasa.php');

            }, function myError(response) {
                console.log(response);

            });
        };

        $scope.googleDrive = function(x){

            var albumData ={
                albumnName:'',
                img:[],
                userName:''
            };
            console.log(x);
            albumData.albumnName =x.name;
            albumData.userName = $rootScope.profileName;
            var photo = x.photos;
            for(j=0;j<photo.length;j++){
                albumData.img.push(photo[j].images[1].source);
            }
            console.log(albumData);
            $http({
                method: 'POST',
                url: 'sendData.php',
                data: albumData,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }).then(function mySuccess(data) {
                $scope.picasa = true;
                var base_url = window.location.origin;
                $window.open(base_url+'/upload.php');

            }, function myError(response) {
                console.log(response);

            });

            //$window.open('upload.php');
        };

        $scope.googleDriveAllAlbumn = function(){

            var lst = $scope.albumnList;
            var len = lst.length;

            if(len<=0){
                alert("There is no album.");
                return;
            };

            var allAlbumnList = [];


            var i;
            for(i=0;i<len;i++){
                var albumnData = {
                    albumnName:'',
                    image:[]
                };
                var albumn = lst[i];
                albumnData.albumnName = albumn.name;
                var j;
                var albumnPhoto = albumn.photos;

                for (j = 0; j < albumnPhoto.length; j++) {
                    albumnData.image.push(albumnPhoto[j].images[1].source);
                }
                allAlbumnList.push(albumnData);
            }

            var allAlbumnData = {
              albumnList: allAlbumnList,
              userName: $rootScope.profileName
            };

            $http({
                method : "POST",
                url: 'sendAllData.php',
                data: allAlbumnData,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            }).then(function mySuccess(data) {

                var base_url = window.location.origin;
                $window.open(base_url+'/uploadAllAlbumn.php');

            }, function myError(response) {
                console.log(response);
            });
        };

        $scope.googleDriveSelectedAlbumn = function() {


            var allAlbumnList = $scope.selectedAlbumnList;

            if(allAlbumnList.length>0) {
                var allAlbumnData = {
                    albumnList: allAlbumnList,
                    userName: $rootScope.profileName
                };

                $http({
                    method: "POST",
                    url: 'sendAllData.php',
                    data: allAlbumnData,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(function mySuccess(data) {

                    var base_url = window.location.origin;
                    $window.open(base_url + '/uploadAllAlbumn.php');

                }, function myError(response) {
                    console.log(response);
                });
            }else{
                alert('Please, select albumn!!!');
            }
        };
    });
</script>
</body>
</html>
